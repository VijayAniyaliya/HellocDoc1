@model Services.Models.SchedullingViewModel


<table class="table table-bordered">
    <thead class="text-white" style="background: #504a4a;">
        <tr>
            <th class="" style="">STAFF</th>
            <th>12A</th>
            <th>1A</th>
            <th>2A</th>
            <th>3A</th>
            <th>4A</th>
            <th>5A</th>
            <th>6A</th>
            <th>7A</th>
            <th>8A</th>
            <th>9A</th>
            <th>10A</th>
            <th>11A</th>
            <th>12P</th>
            <th>1P</th>
            <th>3P</th>
            <th>4P</th>
            <th>5P</th>
            <th>6P</th>
            <th>12P</th>
            <th>7P</th>
            <th>8P</th>
            <th>9P</th>
            <th>10P</th>
            <th>11P</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td scope="row">Coverage</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>   
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        @foreach (var obj in Model.physicians)
        {   
            var shift = Model.ShiftDetailList.Where(u => u.ShiftDate.Date == DateTime.Now.Date && u.Shift.PhysicianId == obj.PhysicianId).ToList();
            <tr>
                <td><div><img src="~/uploads/@obj.Photo" style="    height: 25px; width: 25px;" class="mr-1" />@obj.FirstName</div></td>

                @for (  int i = 0; i < 24; i++)
                {
                    if (shift.Count() > 0)
                    {
                        int flag = 0;
                        foreach (var item in shift)
                        {
                            var diff = item.EndTime.Hour - item.StartTime.Hour + 1;
                            if (item.StartTime.Hour <= i && item.EndTime.Hour >= i)
                            {
                                var perstart = (item.StartTime.Minute / 60.00) * 100;
                                int wid = 100;
                                if (item.EndTime.Minute != 0)
                                {
                                    wid = 58;
                                }
                                perstart /= 2;
                                <td onclick="viewshift(@obj.PhysicianId)" id="i_@obj.PhysicianId" colspan="@diff" class="p-0">
                                    <button class="dates d-flex align-items-center justify-content-center border-0 viewshiftbtn" value="@item.ShiftId" style="height:70.5px;background-color:#efabd2; margin-left:@perstart%;width:@wid%">
                                        @item.StartTime.ToString("hh:mm tt")-@item.EndTime.ToString("hh:mm tt")
                                    </button>
                                </td>
                                i += (@diff - 1);

                                flag = 1;
                            }
                        }
                        if (flag == 0)
                        {
                            <td id="i_@obj.PhysicianId"></td>
                        }
                    }
                    else
                    {
                        <td id="i_@obj.PhysicianId"></td>
                    }
                }
            </tr>
        }
    </tbody>
</table>
<div id="shift"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    function viewshift(PhysicianId) {
        $.ajax({
            url: "/Admin/ViewShift/",
            type: "POST",
            data: { "PhysicanId": PhysicianId },
            dataType: "html",
            success: function (data) {
                $("#shift").html(data);
                const myModal = new bootstrap.Modal("#staticBackdrop", {});
                myModal.show();
            },
            error: function () {
                alert("No Projects Found");
                $("#shift").html('An error has occurred');
            }
        });
    };
</script>